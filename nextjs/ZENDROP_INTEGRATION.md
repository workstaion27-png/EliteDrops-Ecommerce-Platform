# Zendrop Integration for LuxuryHub

Complete integration guide for connecting Zendrop dropshipping platform with your LuxuryHub e-commerce store.

## üìã Table of Contents

- [Features](#features)
- [Requirements](#requirements)
- [Setup Guide](#setup-guide)
- [API Configuration](#api-configuration)
- [Usage](#usage)
- [Webhook Setup](#webhook-setup)
- [Database Schema](#database-schema)
- [Troubleshooting](#troubleshooting)

---

## ‚ú® Features

- **Product Sync**: Import products from Zendrop to your store
- **Real-time Inventory**: Automatic inventory updates via webhooks
- **Order Management**: Create and sync orders with Zendrop
- **Bulk Operations**: Import multiple products at once
- **Auto-sync**: Scheduled inventory synchronization

---

## üìã Requirements

Before starting, ensure you have:

- [x] Zendrop Account ([Sign up](https://zendrop.com))
- [x] API Key from Zendrop
- [x] Supabase Project for data storage
- [x] Node.js 18+ and pnpm

---

## üöÄ Setup Guide

### 1. Configure Environment Variables

Copy the example environment file:

```bash
cp nextjs/.env.zendrop.example nextjs/.env.local
```

Add your Zendrop API key:

```env
ZENDROP_API_KEY=your_api_key_here
ZENDROP_WEBHOOK_SECRET=your_webhook_secret
```

**Get your API key:**
1. Go to [Zendrop Settings > API](https://app.zendrop.com/settings/api)
2. Click "Generate New Key"
3. Copy the key

### 2. Set Up Database

Run the following SQL in your Supabase SQL Editor:

```sql
-- Add Zendrop fields to products table
ALTER TABLE products ADD COLUMN IF NOT EXISTS zendrop_id INTEGER;
ALTER TABLE products ADD COLUMN IF NOT EXISTS zendrop_sku TEXT;
ALTER TABLE products ADD COLUMN IF NOT EXISTS zendrop_last_sync TIMESTAMP WITH TIME ZONE;

-- Create sync logs table
CREATE TABLE IF NOT EXISTS sync_logs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    provider TEXT NOT NULL,
    type TEXT NOT NULL,
    status TEXT NOT NULL,
    synced_count INTEGER DEFAULT 0,
    error_count INTEGER DEFAULT 0,
    errors JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create settings table for storing sync metadata
CREATE TABLE IF NOT EXISTS settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable RLS policies
ALTER TABLE sync_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE settings ENABLE ROW LEVEL SECURITY;

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_products_zendrop_id ON products(zendrop_id);
CREATE INDEX IF NOT EXISTS idx_sync_logs_created_at ON sync_logs(created_at DESC);
```

### 3. Deploy Changes

```bash
git add .
git commit -m "Add Zendrop integration"
git push origin main
```

Vercel will auto-deploy with your new environment variables.

---

## üîß API Configuration

### Available Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/zendrop/products` | GET | Fetch products from Zendrop |
| `/api/zendrop/products` | POST | Import/sync products |
| `/api/zendrop/orders` | GET | Fetch orders from Zendrop |
| `/api/zendrop/orders` | POST | Create orders |
| `/api/zendrop/sync` | GET | Get sync status |
| `/api/zendrop/sync` | POST | Trigger sync operations |
| `/api/zendrop/webhook` | POST | Receive webhook events |

### Example: Fetch Products

```typescript
// Client-side
const response = await fetch('/api/zendrop/products?page=1&per_page=20')
const data = await response.json()

if (data.success) {
  console.log(data.products)
}
```

### Example: Trigger Full Sync

```typescript
// Server-side or admin panel
const response = await fetch('/api/zendrop/sync', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ action: 'full_sync' }),
})

const result = await response.json()
console.log(`Synced ${result.synced} products`)
```

---

## üîî Webhook Setup

Webhooks enable real-time updates from Zendrop.

### 1. Configure Webhook in Zendrop

1. Go to [Zendrop Settings > Webhooks](https://app.zendrop.com/settings/webhooks)
2. Click "Add Webhook"
3. Enter your webhook URL:
   ```
   https://yourdomain.com/api/zendrop/webhook
   ```
4. Select events to receive:
   - `order.created`
   - `order.shipped`
   - `order.cancelled`
   - `product.inventory.updated`
5. Save

### 2. Webhook Events

| Event | Description |
|-------|-------------|
| `order.created` | New order placed |
| `order.shipped` | Order shipped with tracking |
| `order.delivered` | Order delivered |
| `order.cancelled` | Order cancelled |
| `product.inventory.updated` | Inventory count changed |
| `product.out_of_stock` | Product out of stock |

---

## üí° Usage

### Admin Panel

Access the Zendrop management panel at:
```
/admin-control/zendrop
```

Features:
- View sync status
- Browse synced products
- Trigger manual sync
- Configure settings

### Product Sync

```typescript
// Import all products
const result = await fetch('/api/zendrop/sync', {
  method: 'POST',
  body: JSON.stringify({ action: 'full_sync' }),
})

// Import specific products
const result = await fetch('/api/zendrop/sync', {
  method: 'POST',
  body: JSON.stringify({
    action: 'bulk_products',
    productIds: ['123', '456', '789'],
  }),
})
```

### Order Creation

```typescript
// Create order in Zendrop
const result = await fetch('/api/zendrop/orders', {
  method: 'POST',
  body: JSON.stringify({
    action: 'create',
    items: [
      { product_id: 123, quantity: 2 },
    ],
    shipping_address: {
      first_name: 'John',
      last_name: 'Doe',
      address1: '123 Main St',
      city: 'New York',
      state: 'NY',
      zip: '10001',
      country: 'US',
    },
  }),
})
```

---

## üóÑÔ∏è Database Schema

### Products Table

```sql
CREATE TABLE products (
  id UUID PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  compare_price DECIMAL(10, 2),
  images JSONB,
  category TEXT,
  inventory_count INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  zendrop_id INTEGER,        -- Zendrop product ID
  zendrop_sku TEXT,          -- Zendrop SKU
  zendrop_last_sync TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### Sync Logs Table

```sql
CREATE TABLE sync_logs (
  id BIGINT PRIMARY KEY,
  provider TEXT NOT,         -- 'zendrop'
  type TEXT NOT,             -- 'full', 'inventory', 'product'
  status TEXT NOT,           -- 'success', 'failed'
  synced_count INTEGER DEFAULT 0,
  error_count INTEGER DEFAULT 0,
  errors JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## üîß Troubleshooting

### API Key Not Working

**Error:** `Zendrop API key not configured`

**Solution:**
1. Check your `.env.local` file
2. Verify API key is correct
3. Ensure `ZENDROP_API_KEY` is set
4. Redeploy after adding environment variable

### Webhook Not Receiving Events

**Solution:**
1. Verify webhook URL is accessible (not localhost)
2. Check Zendrop webhook settings
3. Enable webhook in settings: `ZENDROP_WEBHOOK_ENABLED=true`
4. Check server logs for errors

### Products Not Syncing

**Error:** `Failed to sync products`

**Solution:**
1. Verify API key has correct permissions
2. Check product exists in Zendrop account
3. Review sync logs in database
4. Try individual product sync first

### Inventory Not Updating

**Solution:**
1. Set up webhooks for real-time updates
2. Run manual inventory sync
3. Check product mapping (zendrop_id field)
4. Verify Supabase connection

---

## üìû Support

- **Zendrop Help Center**: [help.zendrop.com](https://help.zendrop.com)
- **Zendrop Dashboard**: [app.zendrop.com](https://app.zendrop.com)
- **GitHub Issues**: Report bugs here

---

## üìù License

MIT License - Feel free to use and modify for your projects.

---

## ‚úÖ Checklist

- [ ] Zendrop account created
- [ ] API key generated
- [ ] Environment variables configured
- [ ] Database schema applied
- [ ] Webhook configured
- [ ] Test product sync
- [ ] Test order creation
- [ ] Monitor sync logs
